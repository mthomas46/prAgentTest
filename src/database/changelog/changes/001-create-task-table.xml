<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.4.xsd">

    <changeSet id="001" author="pragent">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM pg_type WHERE typname = 'task_priority';
            </sqlCheck>
        </preConditions>
        <sql>
            CREATE TYPE task_priority AS ENUM ('LOW', 'MEDIUM', 'HIGH');
        </sql>
    </changeSet>

    <changeSet id="002" author="pragent">
        <sql>
            CREATE TABLE IF NOT EXISTS public.task (
                id UUID NOT NULL,
                title VARCHAR(255) NOT NULL,
                description TEXT NOT NULL,
                completed BOOLEAN DEFAULT FALSE NOT NULL,
                priority task_priority DEFAULT 'MEDIUM' NOT NULL,
                due_date TIMESTAMP,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
                deleted_at TIMESTAMP,
                CONSTRAINT task_pkey PRIMARY KEY (id)
            );
        </sql>
        <rollback>
            DROP TABLE IF EXISTS public.task;
            DROP TYPE IF EXISTS task_priority;
        </rollback>
    </changeSet>
</databaseChangeLog> 